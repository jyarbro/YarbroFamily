@page
@model App.Areas.Homes.Pages.IndexModel
@inject IAuthorizationService Auth
@{ ViewData["Title"] = "Homes"; }

@if (Model.Homes.Any()) {
    <p class="mb-3">Sorted by: <select asp-for="Sort" asp-items="@Model.SortOptions"></select></p>

    <table class="table table-hover rounded">
        <tbody>
            @foreach (var home in Model.Homes) {
                <tr class="row clickable">
                    <td class="col-2 d-block d-lg-none text-center">
                        <p class="badge badge-primary"><span class="h4 font-weight-bold">@($"{home.Score:0}")</span></p>
                    </td>
                    <td class="col">
                        <span class="d-none d-lg-inline"><a class="h5" asp-page="./HomeDetails" asp-route-id="@home.Id">@home.Address</a></span>
                        <div class="d-block d-lg-none">
                            <p><a class="h5" asp-page="./HomeDetails" asp-route-id="@home.Id">@home.HouseNumber @home.StreetName</a></p>
                            <p><a class="h5" asp-page="./HomeDetails" asp-route-id="@home.Id">@home.City, @home.Zip @home.State</a></p>
                            <p>Updated <passed-time time="@home.Updated" /></p>
                            <p>
                                @foreach (var userScore in home.UserScores) {
                                    <span class="badge badge-light" title="@userScore.Name">@userScore.Score</span>
                                }
                            </p>
                        </div>
                    </td>
                    <td class="col-1 d-none d-lg-inline text-center">
                        <p class="h3 font-weight-bold"><span class="badge badge-primary">@($"{home.Score:0.#}")</span></p>
                    </td>
                    <td class="col-3 d-none d-lg-inline">
                        <p class="font-small mb-1">
                            Family Scores:
                            @foreach (var userScore in home.UserScores) {
                                <span class="badge badge-primary" title="@userScore.Name">@userScore.Score</span>
                            }
                        </p>
                        <p class="font-smaller">
                            @if (home.Updated > DateTime.Now.AddDays(-1)) {
                                <span class="font-weight-bold">Updated <passed-time time="@home.Updated" /> by @home.UpdatedBy</span>
                            }
                            else {
                                <span>Updated <passed-time time="@home.Updated" /> by @home.UpdatedBy</span>
                            }
                        </p>
                        <p class="font-smaller">
                            @if (home.Created > DateTime.Now.AddDays(-1)) {
                                <span class="font-weight-bold">Created <passed-time time="@home.Created" /> by @home.CreatedBy</span>
                            }
                            else {
                                <span>Created <passed-time time="@home.Created" /> by @home.CreatedBy</span>
                            }
                        </p>
                    </td>
                </tr>
            }
        </tbody>
    </table>
}

@if (await Auth.IsParent(User)) {
    <p>
        <a class="btn btn-primary" asp-area="Homes" asp-page="./CreateHome">Add a Home</a>
    </p>
}

@section Scripts {
    <script>
        let pageAddress = "@Url.Page("./Index")";

        $(function () {
            $('select[name="Sort"]').on('change', function () {
                window.location = pageAddress + "?sort=" + this.value;
            });
        });
    </script>
}